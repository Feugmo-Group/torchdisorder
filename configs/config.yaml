# TorchDisorder Configuration
# ===========================
#
# Usage:
#   python scripts/train.py                              # Use defaults (SiO2, neutron)
#   python scripts/train.py data=SiO2 structure=silica   # SiO2 glass (neutron)
#   python scripts/train.py data=GeO2 structure=GeO2     # GeO2 glass (neutron)
#   python scripts/train.py data=LiPS structure=LiPS     # Li-P-S glass (X-ray)
#   python scripts/train.py target=F_Q                   # F(Q) target
#   python scripts/train.py target=G_r                   # G(r) target (for X-ray PDF)
#   python scripts/train.py structure.supercell.target_atoms=2000  # Larger cell

experiment_name: SiO2
defaults:
  - data: SiO2  #  SiO2 GeO2, LiPS
  - structure: silica # silica,  GeO2, LiPS
  - trainer: cooper
  - wandb: enabled
  - _self_

# =============================================================================
# Device
# =============================================================================
accelerator: 'cpu'  # cuda, mps, cpu

# =============================================================================
# Target Selection
# =============================================================================
# Options: S_Q, F_Q, T_r, g_r, G_r
#   - S_Q: Structure factor S(Q) → 1 as Q → ∞
#   - F_Q: Reduced structure factor F(Q) = Q[S(Q)-1] → 0 as Q → ∞
#   - g_r: Pair distribution function g(r) → 1 as r → ∞
#   - G_r: Reduced PDF G(r) = 4πρr[g(r)-1] → 0 as r → ∞ (PDFgetX3 output)
#   - T_r: Total correlation function T(r) = 4πρr·g(r)
target: F_Q

# =============================================================================
# Optimization
# =============================================================================
max_steps: 5000
optimize_cell: false

lr:
  primal: 1e-3
  dual: 1e-2
  primal_reduced: 1e-4
  dual_reduced: 1e-3

# =============================================================================
# Adaptive Penalty
# =============================================================================
penalty:
  init: 10.0
  growth_rate: 1.5
  decay_rate: 0.95
  max_penalty: 1000.0
  min_penalty: 1.0
  patience: 10

# =============================================================================
# Stability
# =============================================================================
stability:
  grad_clip_norm: 1.0
  max_displacement: 0.1
  constraint_warmup_steps: 500

# =============================================================================
# Constraints
# =============================================================================
constraints:
  enabled: true
  use_types: all  # 'all' or [tet, cn, q4, ...]

# =============================================================================
# Order Parameters
# =============================================================================
order_params:
  backend: auto  # auto, pytorch, warp
  cutoff: 5.5
  max_neighbors: 4

# =============================================================================
# Output
# =============================================================================
checkpoint_interval: 200

output:
  write_trajectory: true
  trajectory_path: ${hydra:run.dir}/trajectory
  save_plots: true
  plots_dir: ${hydra:run.dir}/plots
  plot_interval: 100

# =============================================================================
# Hydra
# =============================================================================
hydra:
  run:
    dir: outputs/${experiment_name}_${now:%Y-%m-%d}/${now:%H-%M-%S}
  sweep:
    dir: outputs/multirun/{experiment_name}_${now:%Y-%m-%d}/${now:%H-%M-%S}
